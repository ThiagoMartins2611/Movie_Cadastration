<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>

    <header>
 
        <h1>Main</h1>

        <nav>
            <ul>

              <li><a href="#">Categorias</a></li>
              <li><a href="#">Seus Filmes</a></li>
              <li><a href="#">Usuarios</a></li>
              
            </ul>
        </nav>

        <form action="/search" method="get">
            <input type="text" name="q" placeholder="Pesquisar...">
            <button type="submit">üîç</button>
        </form>

        
        <div id="user">
            <img src="" alt="" >
            
        </div>

    </header>



    <main>

        <ul id="lista">
    
        </ul>
    
        
        <button id="erase" onclick="erase()">apagar token</button>

    </main>
    
    

    <footer></footer>
   
    <script>

       window.onload = async () => {

        const token = localStorage.getItem("token");

        if(!token){
            alert("token n√£o encontrado, fa√ßa login... redirecionando para login");
            window.location.href = "login.html";

            return;
        }

        const res = await fetch('http://localhost:7000/page', {
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });


        if (!res.ok) {
            localStorage.removeItem("token");
            alert("Voc√™ n√£o est√° logado ou o token expirou. Redirecionando para login...");
            window.location.href = "login.html";
        }

        const data = await res.json();

        if (res.ok) {
            console.log("Usu√°rio logado:", data.usuario);
            // Exibir dados na tela, etc
        } else {
            alert("Voc√™ n√£o est√° logado ou o token expirou. Redirecionando para login...");
            window.location.href = "login.html";
            
        }
    };

    function erase(){
        localStorage.removeItem("token");
        window.location.href = "login.html";
    }

    </script>
</body>
</html>